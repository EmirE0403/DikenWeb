var DikenWeb=DikenWeb||{};!function(e){window.DikenWeb=window.DikenWeb||{},window.DikenWeb.DikenWebError=class extends Error{constructor(e,r="DIKENWEB_ERROR"){super(e),this.name="DikenWebError",this.code=r}},window.DikenWeb.WebGLNotSupportedError=class extends window.DikenWeb.DikenWebError{constructor(){super("WebGL tarayıcınız tarafından desteklenmiyor","WEBGL_NOT_SUPPORTED")}},window.DikenWeb.Core=class{constructor(e){if(!e)throw new window.DikenWeb.DikenWebError("Canvas elementi gereklidir","CANVAS_REQUIRED");this.canvas=e,this.gl=null;try{if(this.gl=e.getContext("webgl")||e.getContext("experimental-webgl"),!this.gl)throw new window.DikenWeb.WebGLNotSupportedError}catch(e){const r="DikenWeb: WebGL başlatılamadı.\nSebep: "+e.message;throw console.error(r,e),window.DikenWeb.Core.showErrorMessage(r),new window.DikenWeb.DikenWebError(r,"WEBGL_INIT_FAILED")}this.renderer=null,this.currentScene=null,this.isRunning=!1,this.lastTime=0}static showErrorMessage(e){const r=document.querySelector(".dikenweb-error");if(r)return void(r.innerText=e);const t=document.createElement("div");t.className="dikenweb-error",t.style.cssText="\n      position: absolute;\n      top: 20px;\n      left: 20px;\n      background: #ff4444;\n      color: white;\n      padding: 15px;\n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n      z-index: 9999;\n      border-radius: 8px;\n      box-shadow: 0 4px 8px rgba(0,0,0,0.3);\n      max-width: 80%;\n      word-break: break-word;\n      border-left: 4px solid #ff0000;\n    ",t.innerHTML=`\n      <strong>🌵 DikenWeb Hatası</strong><br>\n      <small>${e}</small>\n    `,document.body.appendChild(t)}init(){try{this.renderer=new window.DikenWeb.Renderer(this.gl),this.renderer.init(),console.log("✅ DikenWeb başlatıldı")}catch(e){const r="DikenWeb: Renderer başlatılamadı.\nSebep: "+e.message;throw console.error(r,e),window.DikenWeb.Core.showErrorMessage(r),new window.DikenWeb.DikenWebError(r,"RENDERER_INIT_FAILED")}}start(){if(!this.isRunning)try{this.isRunning=!0,this.lastTime=performance.now(),this.loop(),console.log("▶️ DikenWeb çalışıyor")}catch(e){const r="DikenWeb: Motor başlatılamadı.\nSebep: "+e.message;throw console.error(r,e),window.DikenWeb.Core.showErrorMessage(r),this.isRunning=!1,new window.DikenWeb.DikenWebError(r,"ENGINE_START_FAILED")}}stop(){this.isRunning=!1,console.log("⏹️ DikenWeb durduruldu")}loop(){if(!this.isRunning)return;const e=performance.now(),r=(e-this.lastTime)/1e3;this.lastTime=e,r>.1&&console.warn(`Büyük delta time: ${r.toFixed(3)}s`);try{this.update(r),this.render()}catch(e){console.error("DikenWeb loop hatası:",e)}requestAnimationFrame(this.loop.bind(this))}update(e){"number"==typeof e?this.currentScene&&this.currentScene.update(e):console.warn("Geçersiz deltaTime:",e)}render(){if(this.renderer&&this.currentScene)try{this.renderer.clear(),this.currentScene.render(this.renderer)}catch(e){throw console.error("Render hatası:",e),new window.DikenWeb.DikenWebError("Render işlemi başarısız: "+e.message,"RENDER_FAILED")}}loadScene(e){if(!e)throw new window.DikenWeb.DikenWebError("Sahne nesnesi gereklidir","SCENE_REQUIRED");this.currentScene=e,console.log("📂 Sahne yüklendi")}},window.DikenWeb=window.DikenWeb||{},window.DikenWeb.RendererError=class extends window.DikenWeb.DikenWebError{constructor(e,r="RENDERER_ERROR"){super(e,r),this.name="RendererError"}},window.DikenWeb.ShaderCompileError=class extends window.DikenWeb.RendererError{constructor(e,r){super(`${e} shader derleme hatası: ${r}`,"SHADER_COMPILE_ERROR"),this.shaderType=e,this.info=r}},window.DikenWeb.ShaderLinkError=class extends window.DikenWeb.RendererError{constructor(e){super(`Shader program bağlama hatası: ${e}`,"SHADER_LINK_ERROR"),this.info=e}},window.DikenWeb.Renderer=class{constructor(e){if(!e)throw new window.DikenWeb.RendererError("WebGL context gereklidir","GL_CONTEXT_REQUIRED");this.gl=e,this.defaultShader=null,this.currentShader=null}init(){try{const e="\n        attribute vec3 a_position;\n        uniform mat4 u_mvpMatrix;\n        void main() {\n          gl_Position = u_mvpMatrix * vec4(a_position, 1.0);\n        }\n      ",r="\n        precision mediump float;\n        uniform vec3 u_color;\n        void main() {\n          gl_FragColor = vec4(u_color, 1.0);\n        }\n      ";this.defaultShader=this.createShaderProgram(e,r),this.currentShader=this.defaultShader,this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),console.log("✅ Renderer başlatıldı")}catch(e){throw new window.DikenWeb.RendererError(`Renderer başlatma hatası: ${e.message}`,"RENDERER_INIT_FAILED")}}createShaderProgram(e,r){if("string"!=typeof e||"string"!=typeof r)throw new window.DikenWeb.RendererError("Shader kaynak kodları string olmalıdır","INVALID_SHADER_SOURCE");try{const r=this.compileShader(this.gl.VERTEX_SHADER,e),t=this.compileShader(this.gl.FRAGMENT_SHADER,fragmentShaderSource),n=this.gl.createProgram();if(this.gl.attachShader(n,r),this.gl.attachShader(n,t),this.gl.linkProgram(n),!this.gl.getProgramParameter(n,this.gl.LINK_STATUS)){const e=this.gl.getProgramInfoLog(n);throw new window.DikenWeb.ShaderLinkError(e)}return n}catch(e){if(e instanceof window.DikenWeb.ShaderLinkError||e instanceof window.DikenWeb.ShaderCompileError)throw e;throw new window.DikenWeb.RendererError(`Shader program oluşturma hatası: ${e.message}`,"SHADER_PROGRAM_FAILED")}}compileShader(e,r){if("string"!=typeof r)throw new window.DikenWeb.RendererError("Shader kaynak kodu string olmalıdır","INVALID_SHADER_SOURCE");try{const t=this.gl.createShader(e);if(this.gl.shaderSource(t,r),this.gl.compileShader(t),!this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS)){const r=this.gl.getShaderInfoLog(t),n=e===this.gl.VERTEX_SHADER?"Vertex":"Fragment";throw new window.DikenWeb.ShaderCompileError(n,r)}return t}catch(e){if(e instanceof window.DikenWeb.ShaderCompileError)throw e;throw new window.DikenWeb.RendererError(`Shader derleme hatası: ${e.message}`,"SHADER_COMPILE_FAILED")}}useShader(e){if(!e)throw new window.DikenWeb.RendererError("Shader programı gereklidir","SHADER_PROGRAM_REQUIRED");this.currentShader=e,this.gl.useProgram(e)}clear(e=.1,r=.1,t=.1,n=1){if("number"!=typeof e||"number"!=typeof r||"number"!=typeof t||"number"!=typeof n)throw new window.DikenWeb.RendererError("Renk parametreleri sayı olmalıdır","INVALID_COLOR_PARAMS");this.gl.clearColor(e,r,t,n),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}setViewport(e,r){if("number"!=typeof e||"number"!=typeof r)throw new window.DikenWeb.RendererError("Viewport boyutları sayı olmalıdır","INVALID_VIEWPORT_SIZE");this.gl.viewport(0,0,e,r)}enableDepthTest(e=!0){e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST)}enableCulling(e=!0){e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE)}},e.DikenWeb.toRadians=function(e){return e*(Math.PI/180)},e.DikenWeb.CameraError=class extends Error{constructor(e,r="CAMERA_ERROR"){super(e),this.name="CameraError",this.code=r}},e.DikenWeb.Camera=class extends Component{constructor(){super(),this.fov=45,this.aspect=1,this.near=.1,this.far=1e3,this.projectionMatrix=new Matrix4,this.viewMatrix=new Matrix4,this._dirty=!0}awake(){this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.fov*Math.PI/180;this.projectionMatrix=Matrix4.perspective(e,this.aspect,this.near,this.far),this._dirty=!1}updateViewMatrix(){if(this.gameObject){const e=this.gameObject.transform.position,r=e.add(new Vector3(0,0,-1)),t=new Vector3(0,1,0);this.viewMatrix=Matrix4.lookAt(e,r,t)}}setPerspective(e,r,t,n){if("number"!=typeof e||"number"!=typeof r||"number"!=typeof t||"number"!=typeof n)throw new CameraError("Kamera parametreleri sayı olmalıdır","INVALID_CAMERA_PARAMS");this.fov=e,this.aspect=r,this.near=t,this.far=n,this.updateProjectionMatrix()}getMVPMatrix(e){if(!(e instanceof Matrix4))throw new CameraError("Model matrix Matrix4 tipinde olmalıdır","INVALID_MATRIX_PARAM");return this.updateViewMatrix(),this.projectionMatrix.multiply(this.viewMatrix).multiply(e)}render(e){}},e.DikenWeb.Object=class{constructor(){this.position=[0,0,0]}},e.DikenWeb.ComponentError=class extends Error{constructor(e,r="COMPONENT_ERROR"){super(e),this.name="ComponentError",this.code=r}},e.DikenWeb.MeshRenderer=class extends Component{constructor(){super(),this.vertices=[],this.color=[1,1,1],this.vertexBuffer=null}awake(){if(this.gameObject&&this.gameObject.engine&&this.gameObject.engine.gl)try{this.createBuffer(this.gameObject.engine.gl)}catch(e){console.error("MeshRenderer buffer oluşturma hatası:",e)}}createBuffer(e){if(!e)throw new ComponentError("WebGL context gereklidir","GL_CONTEXT_REQUIRED");if(!Array.isArray(this.vertices))throw new ComponentError("Vertices array olmalıdır","INVALID_VERTICES_TYPE");this.vertexBuffer&&e.deleteBuffer(this.vertexBuffer),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.vertices),e.STATIC_DRAW)}setColor(e,r,t){if("number"!=typeof e||"number"!=typeof r||"number"!=typeof t)throw new ComponentError("Renk parametreleri sayı olmalıdır","INVALID_COLOR_PARAMS");this.color=[e,r,t]}render(e){if(e){if(this.vertexBuffer&&0!==this.vertices.length)try{const r=e.gl,t=e.currentShader||e.defaultShader;if(!t)return void console.warn("MeshRenderer: Shader programı bulunamadı");r.useProgram(t);const n=r.getAttribLocation(t,"a_position"),i=r.getUniformLocation(t,"u_color"),o=r.getUniformLocation(t,"u_mvpMatrix");if(-1===n)return void console.warn("MeshRenderer: a_position attribute bulunamadı");r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.enableVertexAttribArray(n),r.vertexAttribPointer(n,3,r.FLOAT,!1,0,0),i&&r.uniform3fv(i,this.color);const s=this.gameObject.transform.worldMatrix;o&&r.uniformMatrix4fv(o,!1,s.elements),r.drawArrays(r.TRIANGLES,0,this.vertices.length/3)}catch(e){console.error("MeshRenderer render hatası:",e)}}else console.warn("MeshRenderer: renderer parametresi gereklidir")}onDestroy(){this.vertexBuffer&&this.gameObject&&this.gameObject.engine&&this.gameObject.engine.gl&&(this.gameObject.engine.gl.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null)}},e.DikenWeb.CubeRenderer=class extends MeshRenderer{constructor(){super(),this.vertices=[-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5]}},e.DikenWeb.Script=class extends Component{constructor(){super(),this.properties={}}},e.DikenWeb.SceneError=class extends Error{constructor(e,r="SCENE_ERROR"){super(e),this.name="SceneError",this.code=r}},e.DikenWeb.Scene=class{constructor(e="Scene"){if("string"!=typeof e)throw new SceneError("Sahne adı string olmalıdır","INVALID_SCENE_NAME");this.name=e,this.root=new GameObject("SceneRoot"),this.mainCamera=null}update(e){if("number"==typeof e)try{this.root.update(e)}catch(e){console.error(`Scene update hatası (${this.name}):`,e)}else console.warn("Scene.update: deltaTime parametresi sayı olmalıdır")}render(e){if(e)try{this.root.render(e)}catch(e){console.error(`Scene render hatası (${this.name}):`,e)}else console.warn("Scene.render: renderer parametresi gereklidir")}addGameObject(e){if(!(e instanceof GameObject))throw new SceneError("GameObject tipinde olmayan nesne eklenemez","INVALID_GAMEOBJECT_TYPE");this.root.addChild(e)}removeGameObject(e){if(!(e instanceof GameObject))throw new SceneError("GameObject tipinde olmayan nesne kaldırılamaz","INVALID_GAMEOBJECT_TYPE");this.root.removeChild(e)}findGameObjectWithTag(e){const r=t=>{if(t.tag===e)return t;for(let e of t.children){const t=r(e);if(t)return t}return null};return r(this.root)}findGameObjectsWithTag(e){const r=[],t=n=>{n.tag===e&&r.push(n);for(let e of n.children)t(e)};return t(this.root),r}setMainCamera(e){if(!(e instanceof Camera))throw new SceneError("Kamera Camera tipinde olmalıdır","INVALID_CAMERA_TYPE");this.mainCamera=e}destroy(){try{this.root.destroy()}catch(e){console.error(`Scene destroy hatası (${this.name}):`,e)}}}}("undefined"!=typeof window?window:this);